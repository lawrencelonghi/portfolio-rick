services:
  # Backend API + Frontend
  backend:
    build:
      context: .
      dockerfile: ./server/Dockerfile
    container_name: rick-backend
    restart: unless-stopped
    env_file:
      - ./server/.env.production
    volumes:
      - backend-data:/app/data
      - backend-uploads:/app/uploads
    networks:
      - app-network

  # HTTPS Portal
  https-portal:
    image: steveltn/https-portal:1
    container_name: rick-https-portal
    restart: unless-stopped
    ports:
      - '80:80'
      - '443:443'
    environment:
      DOMAINS: 'ricktadeu.com.br -> http://backend:3000'
      STAGE: 'production'
      CLIENT_MAX_BODY_SIZE: '100M'  
      PROXY_CONNECT_TIMEOUT: '600'  
      PROXY_SEND_TIMEOUT: '600'     
      PROXY_READ_TIMEOUT: '600'     
    volumes:
      - https-portal-data:/var/lib/https-portal
    networks:
      - app-network
    depends_on:
      - backend

volumes:
  backend-data:
    driver: local
  backend-uploads:
    driver: local
  https-portal-data:
    driver: local

networks:
  app-network:
    driver: bridge